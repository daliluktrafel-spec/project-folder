<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ŸÖŸÜÿµÿ© ŸÖÿ™ÿßÿ¨ÿ± ÿßŸÑÿ®ŸÑÿßÿØ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: "Segoe UI", Tahoma, Arial, sans-serif;
    background: linear-gradient(to bottom,#f2f2f2 0%,#4a6cf7 25%,#6a1b9a 75%,#f2f2f2 100%);
    color: #333;
}

.header {
    background: #6a1b9a;
    padding: 20px;
    text-align: center;
    font-size: 24px;
    font-weight: bold;
    color: white;
    position: relative;
}

.fav-top {
    position: absolute;
    left: 15px;
    top: 15px;
    background: white;
    color: #e53935;
    padding: 6px 12px;
    border-radius: 20px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

.container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    padding: 20px;
}

.card {
    background: white;
    border-radius: 15px;
    padding: 15px;
    text-align: center;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
}

.product-img {
    width: 100%;
    aspect-ratio: 1 / 1;
    border-radius: 12px;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    margin-bottom: 10px;
}

.product-name { font-weight: bold; font-size: 16px; }
.product-price { color: #e53935; font-weight: bold; }
.product-store { color: #1e88e5; font-size: 14px; }
.product-status { color: #6a1b9a; font-size: 14px; }

.actions {
    display: flex;
    gap: 8px;
    margin-top: auto;
}

.btn-order {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 10px;
    background: linear-gradient(45deg,#6a1b9a,#3949ab);
    color: white;
    font-weight: bold;
    cursor: pointer;
}

.btn-fav {
    width: 45px;
    border: none;
    border-radius: 10px;
    background: #eee;
    font-size: 20px;
    cursor: pointer;
}

.btn-fav.active {
    background: #ffe5e5;
    color: #e53935;
}

.empty-placeholder {
    display: flex;
    justify-content: center;
    align-items: center;
    background: #fff;
    border-radius: 15px;
    height: 150px;
    margin: 0 auto;
}
.empty-placeholder img {
    max-width: 50%;
    max-height: 50%;
}

.tabs {
    display: flex;
    justify-content: center;
    gap: 10px;
    padding: 15px;
    position: fixed;
    bottom: 0;
    width: 100%;
    background: #ffffffcc;
}

.tab {
    padding: 10px 20px;
    border-radius: 12px;
    border: 2px solid #6a1b9a;
    font-weight: bold;
    cursor: pointer;
    background: #f2f2f2;
}

.tab.active {
    background: #6a1b9a;
    color: white;
}

@media (max-width: 600px) {
    .container {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        padding: 15px;
    }
}
</style>
</head>

<body>

<div class="header" id="welcome">
    ŸÖÿ±ÿ≠ÿ®ÿß ÿ®ŸÉ
    <div class="fav-top" onclick="showFavorites()">‚ù§Ô∏è <span id="favCount">0</span></div>
</div>

<div style="padding:15px;text-align:center;">
    <input type="text" id="searchInput" placeholder="üîç ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖŸÜÿ™ÿ¨ ÿ£Ÿà ŸÖÿ™ÿ¨ÿ±..." onkeyup="smartSearch()"
    style="width:90%;max-width:400px;padding:12px;border-radius:12px;border:1px solid #ccc;font-size:16px;">
</div>

<div id="favorites" class="container" style="display:none;"></div>
<div id="all" class="container"></div>
<div id="available" class="container" style="display:none;"></div>
<div id="stores" class="container" style="display:none;"></div>

<div class="tabs">
    <div class="tab active" onclick="showAllProducts(this)">ŸÉŸÑ ÿßŸÑÿ®ÿ∂ÿßÿ¶ÿπ</div>
    <div class="tab" onclick="showAvailable(this)">ÿßŸÑŸÖÿ™ŸàŸÅÿ±</div>
    <div class="tab" onclick="showStores(this)">ÿßŸÑŸÖÿ™ÿßÿ¨ÿ±</div>
</div>

<script src="products.js"></script>
<script>
const userName = localStorage.getItem("userName") || "ŸÖÿ≥ÿ™ÿÆÿØŸÖ";
const userRegion = localStorage.getItem("userRegion") || "";
document.getElementById("welcome").childNodes[0].nodeValue = `ŸÖÿ±ÿ≠ÿ®Ÿãÿß ${userName} ŸÖŸÜ ${userRegion}`;

let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
saveFav();
function saveFav(){
    localStorage.setItem("favorites", JSON.stringify(favorites));
    document.getElementById("favCount").innerText = favorites.length;
}

const allProductsOriginal = [...products]; // ÿ≠ŸÅÿ∏ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑÿ£ÿµŸÑŸäÿ©

// ÿπÿ±ÿ∂ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖÿπ ÿ•ŸÖŸÉÿßŸÜŸäÿ© ŸÅŸÑÿ™ÿ±ÿ©
function renderProducts(containerId, filter = () => true){
    const c = document.getElementById(containerId);
    c.innerHTML = "";
    const filtered = allProductsOriginal.filter(filter);
    if(filtered.length === 0){
        const empty = document.createElement("div");
        empty.className = "empty-placeholder";
        empty.innerHTML = `<img src="ÿßŸÑÿ¥ÿπÿßÿ±.png" alt="ÿ¥ÿπÿßÿ±">`;
        c.appendChild(empty);
        return;
    }
    filtered.forEach(p=>{
        const favActive = favorites.includes(p.id);
        const d = document.createElement("div");
        d.className = "card";
        d.onclick = ()=>location.href=`product.html?productId=${p.id}`;
        d.innerHTML = `
            <div class="product-img" style="background-image:url('${p.image}')"></div>
            <div class="product-name">${p.name}</div>
            <div class="product-price">${p.price}</div>
            <div class="product-store">${p.store}</div>
            <div class="product-status">${p.status}</div>
            <div class="actions">
                <button class="btn-order" onclick="order('${p.name}','${p.price}','${p.store}',event)">ÿßÿ∑ŸÑÿ®</button>
                <button class="btn-fav ${favActive?'active':''}" onclick="toggleFav(${p.id},event)">‚ù§Ô∏è</button>
            </div>
        `;
        c.appendChild(d);
    });
}

// ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ™ÿßÿ¨ÿ±
function renderStores(){
    const c = document.getElementById("stores");
    c.innerHTML = "";
    const storesList = [...new Set(products.map(p=>p.store))];
    if(storesList.length === 0){
        const empty = document.createElement("div");
        empty.className = "empty-placeholder";
        empty.innerHTML = `<img src="ÿßŸÑÿ¥ÿπÿßÿ±.png" alt="ÿ¥ÿπÿßÿ±">`;
        c.appendChild(empty);
        return;
    }
    storesList.forEach(store => {
        const d = document.createElement("div");
        d.className = "card";
        d.innerText = store;
        d.onclick = () => {
            showSection("all");
            renderProducts("all", p => p.store === store); // ŸÅŸÇÿ∑ ŸÅŸÑÿ™ÿ±ÿ© ŸÖÿ§ŸÇÿ™ÿ©
        };
        c.appendChild(d);
    });
}

// ÿßŸÑŸàÿ∏ÿßÿ¶ŸÅ ÿßŸÑÿ£ÿÆÿ±Ÿâ
function toggleFav(id,e){
    e.stopPropagation();
    favorites = favorites.includes(id) ? favorites.filter(f=>f!==id) : [id,...favorites];
    saveFav();
    renderProducts("all");
}

function showFavorites(){
    showSection("favorites");
    renderProducts("favorites", p=>favorites.includes(p.id));
}

function order(name,price,store,e){
    e.stopPropagation();
    const msg=`ÿßŸÑÿßÿ≥ŸÖ:${userName}%0AÿßŸÑŸÖŸÜÿ∑ŸÇÿ©:${userRegion}%0AÿßŸÑŸÖŸÜÿ™ÿ¨:${name}%0AÿßŸÑÿ≥ÿπÿ±:${price}%0AÿßŸÑŸÖÿ™ÿ¨ÿ±:${store}`;
    window.open(`https://wa.me/967774257557?text=${msg}`,"_blank");
}

function showSection(id){
    ["favorites","all","available","stores"].forEach(s=>{
        document.getElementById(s).style.display="none";
    });
    document.getElementById(id).style.display="grid";
}

// ÿ™ÿ®ŸàŸäÿ® ŸÉŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™
function showAllProducts(el){
    renderProducts("all"); // ÿπÿ±ÿ∂ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ®ÿØŸàŸÜ ŸÅŸÑÿ™ÿ±ÿ©
    showSection("all");
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    el.classList.add("active");
}

// ÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖÿ™ŸàŸÅÿ±
function showAvailable(el){
    renderProducts("all", p=>p.status==="ŸÖÿ™ŸàŸÅÿ±");
    showSection("available");
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    el.classList.add("active");
}

// ÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖÿ™ÿßÿ¨ÿ±
function showStores(el){
    renderStores();
    showSection("stores");
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    el.classList.add("active");
}

function smartSearch(){
    const q = document.getElementById("searchInput").value.toLowerCase();
    if(!q){
        renderProducts("all");
        return;
    }
    renderProducts("all", p =>
        p.name.toLowerCase().includes(q) ||
        p.store.toLowerCase().includes(q) ||
        p.price.toLowerCase().includes(q)
    );
}

// ÿ£ŸàŸÑ ÿ™ÿ≠ŸÖŸäŸÑ
renderProducts("all");
renderProducts("available", p => p.status==="ŸÖÿ™ŸàŸÅÿ±");
renderStores();
</script>

</body>
</html>
