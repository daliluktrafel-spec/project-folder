<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ù†ØµØ© Ù…ØªØ§Ø¬Ø± Ø§Ù„Ø¨Ù„Ø§Ø¯</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: "Segoe UI", Tahoma, Arial, sans-serif;
    background: linear-gradient(to bottom,#f2f2f2 0%,#4a6cf7 25%,#6a1b9a 75%,#f2f2f2 100%);
    color: #333;
}

.header {
    background: #6a1b9a;
    padding: 20px;
    text-align: center;
    font-size: 24px;
    font-weight: bold;
    color: white;
    position: relative;
}

.fav-top {
    position: absolute;
    left: 15px;
    top: 15px;
    background: white;
    color: #e53935;
    padding: 6px 12px;
    border-radius: 20px;
    font-weight: bold;
    cursor: pointer;
}

.container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    padding: 20px;
}

.card {
    background: white;
    border-radius: 15px;
    padding: 12px;
    text-align: center;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    cursor: pointer;
    display: flex;
    flex-direction: column;
}

.product-img {
    width: 100%;
    aspect-ratio: 1 / 1;
    border-radius: 12px;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    margin-bottom: 8px;
}

.product-name { font-weight: bold; font-size: 15px; line-height: 1.3; }
.product-price { color: #e53935; font-weight: bold; }
.product-store { color: #1e88e5; font-size: 14px; }
.product-status { color: #6a1b9a; font-size: 13px; }

.tabs {
    display: flex;
    justify-content: center;
    gap: 10px;
    padding: 15px;
    position: fixed;
    bottom: 0;
    width: 100%;
    background: #ffffffcc;
}

.tab {
    padding: 10px 20px;
    border-radius: 12px;
    border: 2px solid #6a1b9a;
    font-weight: bold;
    background: #f2f2f2;
}

.tab.active { background: #6a1b9a; color: white; }
</style>
</head>

<body>

<div class="header" id="welcome">
    Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ
    <div class="fav-top" onclick="showFavorites()">â¤ï¸ <span id="favCount">0</span></div>
</div>

<div style="padding:15px;text-align:center;">
    <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ Ø£Ùˆ Ù…ØªØ¬Ø±..." style="width:90%;max-width:400px;padding:12px;border-radius:12px;">
</div>

<div id="favorites" class="container" style="display:none;"></div>
<div id="all" class="container"></div>
<div id="available" class="container" style="display:none;"></div>
<div id="stores" class="container" style="display:none;"></div>

<div class="tabs">
    <div class="tab active" onclick="showSection('all',this)">ÙƒÙ„ Ø§Ù„Ø¨Ø¶Ø§Ø¦Ø¹</div>
    <div class="tab" onclick="showSection('available',this)">Ø§Ù„Ù…ØªÙˆÙØ±</div>
    <div class="tab" onclick="showSection('stores',this)">Ø§Ù„Ù…ØªØ§Ø¬Ø±</div>
</div>

<script src="products.js"></script>
<script>
const userName = localStorage.getItem("userName") || "Ù…Ø³ØªØ®Ø¯Ù…";
const userRegion = localStorage.getItem("userRegion") || "";
document.getElementById("welcome").childNodes[0].nodeValue =
`Ù…Ø±Ø­Ø¨Ù‹Ø§ ${userName} ${userRegion}`;

let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
saveFav();

// Ø¯Ø§Ù„Ø© Ù„ØªÙ‚ØµÙŠØ± Ø§Ù„Ø§Ø³Ù… Ù„Ù„ÙƒØ±Øª ÙÙ‚Ø·
function shortName(text, max = 45){ return text.length > max ? text.slice(0,max) + "â€¦" : text; }

function saveFav(){
    localStorage.setItem("favorites", JSON.stringify(favorites));
    document.getElementById("favCount").innerText = favorites.length;
}

const storesList = [...new Set(products.map(p => p.store))];

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function renderProducts(containerId, filter = () => true){
    const c = document.getElementById(containerId);
    c.innerHTML = "";
    products.filter(filter).forEach(p=>{
        const d = document.createElement("div");
        d.className = "card";
        d.onclick = ()=>location.href=`product.html?productId=${p.id}`;
        d.innerHTML = `
            <div class="product-img" style="background-image:url('${p.image}')"></div>
            <div class="product-name">${shortName(p.name)}</div>
            <div class="product-price">${p.price}</div>
            <div class="product-store">${p.store}</div>
            <div class="product-status">${p.status}</div>
        `;
        c.appendChild(d);
    });
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ§Ø¬Ø±
function renderStores(){
    const c = document.getElementById("stores");
    c.innerHTML = "";
    storesList.forEach(s=>{
        const d = document.createElement("div");
        d.className = "card";
        d.innerText = s;
        d.onclick = ()=>renderProducts("stores", p=>p.store===s);
        c.appendChild(d);
    });
}

// Ø§Ù„Ù…ÙØ¶Ù„Ø©
function showFavorites(){
    showSection("favorites");
    renderProducts("favorites", p=>favorites.includes(p.id));
}

// Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
function showSection(id,el){
    ["favorites","all","available","stores"].forEach(s=>{
        document.getElementById(s).style.display="none";
    });
    document.getElementById(id).style.display="grid";
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    if(el) el.classList.add("active");

    if(id==="stores") renderStores();
    else if(id==="all") renderProducts("all");
    else if(id==="available") renderProducts("available",p=>p.status==="Ù…ØªÙˆÙØ±");
    else if(id==="favorites") renderProducts("favorites", p=>favorites.includes(p.id));
}

// â­ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø­Ø³Ù†: Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ + Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±
document.getElementById("searchInput").addEventListener("input", function(){
    const q = this.value.trim().toLowerCase();
    if(!q){
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
        const visibleSection = document.querySelector('.container[style*="display: grid"]')?.id || "all";
        showSection(visibleSection);
        return;
    }
    renderProducts("all", p => 
        p.name.toLowerCase().includes(q) || p.store.toLowerCase().includes(q)
    );
});

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
renderProducts("all");
</script>

</body>
</html>
