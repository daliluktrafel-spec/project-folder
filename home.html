<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ù†ØµØ© Ù…ØªØ§Ø¬Ø± Ø§Ù„Ø¨Ù„Ø§Ø¯</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: "Segoe UI", Tahoma, Arial, sans-serif;
    background: linear-gradient(
        to bottom,
        #f2f2f2 0%,
        #4a6cf7 25%,
        #6a1b9a 75%,
        #f2f2f2 100%
    );
    color: #333;
}

.header {
    background: #6a1b9a;
    padding: 20px;
    text-align: center;
    font-size: 24px;
    font-weight: bold;
    color: white;
}

.container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
    padding: 20px;
}

.card {
    background: white;
    border-radius: 15px;
    padding: 15px;
    text-align: center;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    cursor: pointer;
}

.product-img {
    width: 100%;
    height: 120px;
    border-radius: 10px;
    background-size: cover;
    background-position: center;
    margin-bottom: 10px;
}

.product-name { font-weight: bold; font-size: 18px; }
.product-price { color: #e53935; font-weight: bold; }
.product-store { color: #1e88e5; font-size: 14px; }
.product-status { color: #6a1b9a; font-size: 14px; }

.btn-order {
    margin-top: 10px;
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 10px;
    background: linear-gradient(45deg, #6a1b9a, #3949ab);
    color: white;
    font-weight: bold;
    cursor: pointer;
}

.tabs {
    display: flex;
    justify-content: center;
    gap: 10px;
    padding: 15px;
    position: fixed;
    bottom: 0;
    width: 100%;
    background: #ffffffcc;
}

.tab {
    padding: 10px 20px;
    border-radius: 12px;
    border: 2px solid #6a1b9a;
    font-weight: bold;
    cursor: pointer;
    background: #f2f2f2;
}

.tab.active {
    background: #6a1b9a;
    color: white;
}

/* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬ÙˆØ§Ù„ ÙÙ‚Ø·: 3 Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ø·Ø± ÙˆØ­Ø¬Ù… Ù…ØªÙˆØ³Ø· */
@media (max-width: 600px) {
    .container {
        grid-template-columns: repeat(3, 1fr);
    }

    .product-img {
        height: 100px;
    }

    .card {
        padding: 10px;
    }
}
</style>
</head>

<body>

<div class="header" id="welcome">Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ</div>

<div style="padding:15px;text-align:center;">
    <input
        type="text"
        id="searchInput"
        placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ Ø£Ùˆ Ù…ØªØ¬Ø±..."
        onkeyup="smartSearch()"
        style="
            width:90%;
            max-width:400px;
            padding:12px;
            border-radius:12px;
            border:1px solid #ccc;
            font-size:16px;
        "
    >
</div>

<div id="all" class="container"></div>
<div id="available" class="container" style="display:none;"></div>
<div id="stores" class="container" style="display:none;"></div>

<div class="tabs">
    <div class="tab active" onclick="showSection('all', this)">ÙƒÙ„ Ø§Ù„Ø¨Ø¶Ø§Ø¦Ø¹</div>
    <div class="tab" onclick="showSection('available', this)">Ø§Ù„Ù…ØªÙˆÙØ±</div>
    <div class="tab" onclick="showSection('stores', this)">Ø§Ù„Ù…ØªØ§Ø¬Ø±</div>
</div>

<script src="products.js"></script>
<script>
const userName = localStorage.getItem("userName") || "Ù…Ø³ØªØ®Ø¯Ù…";
const userRegion = localStorage.getItem("userRegion") || "";
document.getElementById("welcome").innerText =
    `Ù…Ø±Ø­Ø¨Ù‹Ø§ ${userName} Ù…Ù† ${userRegion}`;

const storesList = [...new Set(products.map(p => p.store))];

function renderProducts(containerId, filter = () => true) {
    const container = document.getElementById(containerId);
    container.innerHTML = "";
    products.filter(filter).forEach(p => {
        const card = document.createElement("div");
        card.className = "card";
        card.onclick = () => {
            window.location.href = `product.html?productId=${p.id}`;
        };
        card.innerHTML = `
            <div class="product-img" style="background-image:url('${p.image}')"></div>
            <div class="product-name">${p.name}</div>
            <div class="product-price">${p.price}</div>
            <div class="product-store">${p.store}</div>
            <div class="product-status">${p.status}</div>
            <button class="btn-order"
              onclick="order('${p.name}','${p.price}','${p.store}',event)">
              Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†
            </button>
        `;
        container.appendChild(card);
    });
}

function renderStores() {
    const c = document.getElementById("stores");
    c.innerHTML = "";
    storesList.forEach(s => {
        const d = document.createElement("div");
        d.className = "card";
        d.innerText = s;
        d.onclick = () => renderProducts("stores", p => p.store === s);
        c.appendChild(d);
    });
}

function order(name, price, store, e) {
    e.stopPropagation();
    const msg =
        `Ø§Ù„Ø§Ø³Ù…: ${userName}%0AØ§Ù„Ù…Ù†Ø·Ù‚Ø©: ${userRegion}%0A` +
        `Ø§Ù„Ù…Ù†ØªØ¬: ${name}%0AØ§Ù„Ø³Ø¹Ø±: ${price}%0AØ§Ù„Ù…ØªØ¬Ø±: ${store}`;
    window.open(`https://wa.me/967774257557?text=${msg}`, "_blank");
}

function showSection(id, el) {
    ["all","available","stores"].forEach(s =>
        document.getElementById(s).style.display = "none"
    );
    document.getElementById(id).style.display = "grid";
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    el.classList.add("active");
    if (id === "stores") renderStores();
}

function normalizeArabic(text) {
    return text.toLowerCase()
        .replace(/Ø£|Ø¥|Ø¢/g, "Ø§")
        .replace(/Ø©/g, "Ù‡")
        .replace(/Ù‰/g, "ÙŠ")
        .replace(/Ø¤|Ø¦/g, "Ùˆ")
        .replace(/[^Ø¡-ÙŠ0-9\s]/g, "");
}

function smartSearch() {
    const q = normalizeArabic(
        document.getElementById("searchInput").value
    );

    if (!q) {
        renderProducts("all");
        return;
    }

    renderProducts("all", p =>
        normalizeArabic(p.name).includes(q) ||
        normalizeArabic(p.store).includes(q) ||
        normalizeArabic(p.price).includes(q)
    );
}

renderProducts("all");
renderProducts("available", p => p.status === "Ù…ØªÙˆÙØ±");
renderStores();
</script>

</body>
</html>
