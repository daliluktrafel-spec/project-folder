<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>لوحة التحكم</title>
<style>
body {
    margin: 0;
    font-family: "Segoe UI", Tahoma, Arial, sans-serif;
    background: #f7f6f2;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}

header {
    text-align: center;
    padding: 20px;
    font-size: 24px;
    font-weight: bold;
    color: #1b1e33;
}

#content {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    gap: 20px;
    padding: 20px;
    flex-wrap: wrap;
}

.box {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    width: 100%;
    max-width: 450px;
}

.box h3 {
    color: #bfa14a;
    margin-bottom: 12px;
}

input {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
}

button {
    padding: 10px;
    width: 100%;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    background: linear-gradient(45deg,#c9b36a,#b08d2f);
    color: #1b1e33;
    font-size: 16px;
}

/* المربع الذهبي أسفل الصفحة */
.footer-box {
    display: flex;
    justify-content: center;
    gap: 20px;
    padding: 15px;
    background: #bfa14a;
    position: fixed;
    bottom: 0;
    width: 100%;
}

.footer-box button {
    flex: 1;
    padding: 12px;
    font-size: 16px;
    font-weight: bold;
    border-radius: 12px;
    color: #1b1e33;
    background: linear-gradient(45deg,#fff200,#bfa14a);
}
</style>
</head>
<body>

<header id="title"></header>

<div id="content">
    <!-- حقل الإضافة -->
    <div class="box" id="add-box">
        <h3>إضافة منتج</h3>
        <input id="name" placeholder="الاسم" style="color:gold; font-weight:bold;">
        <input id="price" placeholder="السعر" style="color:black;">
        <input id="status" placeholder="الحالة" style="color:gold; font-weight:bold;">
       <input id="image" placeholder="رابط أو اسم الصورة" style="color:black;">
        <input id="category" placeholder="التصنيف" style="color:gold; font-weight:bold;">
        <input id="store" placeholder="المتجر" style="color:black;" readonly>
        <button onclick="add()">حفظ</button>
    </div>

    <!-- حقل التعديل -->
    <div class="box" id="edit-box">
        <h3>تعديل منتجات المتجر</h3>
        <div id="edit-content"></div>
    </div>
</div>

<div class="footer-box">
    <button onclick="showAdd()">إضافة منتج</button>
    <button onclick="showEdit()">تعديل منتجات المتجر</button>
    <button onclick="logout()">خروج</button>
</div>

<script>
const store = localStorage.getItem("selectedStore");
const logged = localStorage.getItem("storeLoggedIn");

if (!store || logged !== store) {
    alert("يجب تسجيل الدخول أولاً");
    window.location.href = "stores.html";
}
</script>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
 apiKey: "AIzaSyAMEoUTIMAS0mh06_SxrM2T_efDxEmEoxg",
 authDomain: "wafaseiyunshop.firebaseapp.com",
 databaseURL: "https://wafaseiyunshop-default-rtdb.firebaseio.com",
 projectId: "wafaseiyunshop",
 storageBucket: "wafaseiyunshop.firebasestorage.app",
 messagingSenderId: "101115796279",
 appId: "1:101115796279:web:3753efad2a443c9b6098b2"
};
firebase.initializeApp(firebaseConfig);
const database=firebase.database();

document.getElementById("title").innerText = "لوحة تحكم — " + store;
document.getElementById("store").value = store;

let products = [];

// تحميل منتجات المتجر
function loadProducts() {
    database.ref("products").once("value", snap => {
        const data = snap.val() || {};
        products = Object.values(data).filter(p => p.store === store);
        renderEditProducts();
    });
}

// عرض منتجات المتجر للتعديل
function renderEditProducts(){
    const container = document.getElementById("edit-content");
    container.innerHTML = "";

    products.forEach(p=>{
        const div = document.createElement("div");
        div.style.border = "1px solid #ccc";
        div.style.padding = "8px";
        div.style.marginBottom = "8px";
        div.innerHTML = `
    <input value="${p.name}" id="name-${p.id}">
    <input value="${p.price}" id="price-${p.id}">
    <input value="${p.status}" id="status-${p.id}">
    <input value="${p.image}" id="image-${p.id}">
    <input value="${p.category}" id="category-${p.id}">
    <input value="${p.store}" readonly>

    <button onclick="saveEdit(${p.id})">تعديل</button>
    <button onclick="deleteProduct(${p.id})" style="background:#d9534f;color:white;margin-top:6px;">
        حذف
    </button>
`;
       container.appendChild(div);
    });
}

// إضافة منتج جديد
function add() {
    const imageValue = document.getElementById("image").value;
    if (!imageValue) {
        alert("أدخل اسم الصورة أو رابطها!");
        return;
    }

    database.ref("products").push({
        id: Date.now(),
        name: name.value,
        price: price.value,
        status: status.value,
        image: imageValue,  // ← الآن فقط الاسم أو الرابط
        category: category.value,
        store: store
    }).then(() => {
        alert("تم الحفظ ✅");
        loadProducts();
    });

    // تنظيف الحقول
    name.value = "";
    price.value = "";
    status.value = "";
    category.value = "";
    image.value = "";
        }
}
// حفظ التعديلات
function saveEdit(id){
    const updated = {
        name: document.getElementById("name-"+id).value,
        price: document.getElementById("price-"+id).value,
        status: document.getElementById("status-"+id).value,
        image: document.getElementById("image-"+id).value,
        category: document.getElementById("category-"+id).value,
        store: store
    };

    database.ref("products")
    .orderByChild("id")
    .equalTo(id)
    .once("value", snap=>{
        snap.forEach(child=>{
            child.ref.update(updated).then(()=>{
                alert("تم التعديل ✅");
                loadProducts();
            });
        });
    });
}

// حذف المنتج
function deleteProduct(id){
    if(!confirm("هل تريد حذف المنتج؟")) return;

    database.ref("products")
    .orderByChild("id")
    .equalTo(id)
    .once("value", snap=>{
        snap.forEach(child=>{
            child.ref.remove();
        });
        alert("تم الحذف ✅");
        loadProducts();
    });
}

// أزرار التنقل بين الإضافة والتعديل
function showAdd(){
    document.getElementById("add-box").style.display = "block";
    document.getElementById("edit-box").style.display = "none";
}
function showEdit(){
    document.getElementById("add-box").style.display = "none";
    document.getElementById("edit-box").style.display = "block";
    loadProducts();
}

// العرض المبدئي
showAdd();

function logout(){
    localStorage.removeItem("storeLoggedIn");
    localStorage.removeItem("selectedStore");
    window.location.href = "stores.html";
}

</script>

</body>
</html>
