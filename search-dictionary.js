/* =====================================================
   Search Dictionary – Arabic (Large, Smart, & Fast)
   ===================================================== */

/* ===== 1. Normalize Arabic text ===== */
function normalizeArabic(text) {
    return text
        .toLowerCase()
        .replace(/[إأآا]/g, "ا")
        .replace(/ى/g, "ي")
        .replace(/ة/g, "ه")
        .replace(/[ؤئ]/g, "و")
        .replace(/ء/g, "")
        .replace(/ـ/g, "")
        .replace(/[\u064B-\u065F]/g, "")
        .replace(/[^\u0600-\u06FF\s]/g, "")
        .replace(/\s+/g, " ")
        .trim();
}

/* ===== 2. Smart dictionary entries =====
   (key -> list of common synonyms + misspellings)
*/
const RAW_DICTIONARY = {
    /* ---------- أحذية وملحقات ---------- */
    "حذاء": ["جزمة","جزم","حذا","احذية","احذيه","شوز","بوط","شوزات","بوتات","حذاء"],
    "احذية": ["حذاء","جزمة","جزم","حذا","احذيه","شوز","بوط"],
    "شوز": ["حذاء","جزمة","جزم","بوط"],
    "بوت": ["حذاء","بوت","شوز"],
    "سنيكرز": ["سنيكر","سنيكرز","شوز"],
    "جرابات": ["جوارب","جراب","جوارب","جربب"],

    /* ----------- ملابس ----------- */
    "قميص": ["قمصان","قميص","قميصات","قميصين"],
    "قمصان": ["قميص","قميصات"],
    "بنطلون": ["بنطال","سروال","بنطلونات","بنطالات"],
    "تيشيرت": ["تي شيرت","تشيرت","تيشيرتات"],
    "سروال": ["بنطلون","بنطال"],
    "فستان": ["فساتين","فستان","فستانات"],
    "جاكيت": ["جاكيت","جواكيت","معطف"],

    /* ----------- شنط ----------- */
    "شنطة": ["شنط","حقيبه","حقيبة","شنط","شنات"],
    "حقيبه": ["شنطة","شنط","شنط","حقائب"],

    /* ----------- عناية وجمال ----------- */
    "عطر": ["عطور","برفان","برفانات","عطر","عطوره"],
    "صابون": ["صابونة","صابونيه","صابون","صابونه"],
    "كريم": ["مرطب","كريم","كريمه"],
    "مرطب": ["كريم","مرطب","ترطيب"],

    /* ----------- منزل ----------- */
    "مفرش": ["مفارش","فرش","مفرش","مفرتها"],
    "مناديل": ["منديل","منايل","مناديل"],
    "غلاية": ["غلايه","ابريق","اباريق","غلايات"],
    "كوب": ["كاسات","اكواب","كوب","كوبه"],
    "طبق": ["اطباق","طبق","طبقه"],

    /* ----------- ألعاب ----------- */
    "لعبة": ["العاب","العاب","لعبه","العابه","العابين"],
    "العاب": ["لعبة","لعبه"],

    /* ----------- إكسسوارات ----------- */
    "نظارة": ["نضاره","نظاره","نضاره","نظارات"],
    "سوار": ["اسواره","اساور","سوار","اسواره"],

    /* ----------- إلكترونيات ----------- */
    "سماعة": ["سماعات","هيدفون","هيدفونز","سماعات","سماعه"],
    "هيدفون": ["سماعة","سماعات"],
    "شاحن": ["شواحن","شاحن","شاحنات"],

    /* ----------- أطفال ----------- */
    "اطفال": ["اطفال","طفل","بنات","اولاد"],
    "بنات": ["بنات","بنوته","بنات"],
    "اولاد": ["صبيان","اولاد","اطفال"],

    /* ----------- عامية شائعة ----------- */
    "حذا": ["حذاء","جزمة","جزم","احذية"],
    "جزمه": ["حذاء","حذا","جزم","احذية"],
    "جزم": ["حذاء","حذا","جزمه","احذية"],
    "شنطه": ["شنطة","شنط","حقيبه"],
    "حقيبه": ["شنطة","شنط","شنط"],
    "عطري": ["عطر","عطور","برفان"],
    "لعاب": ["العاب","لعبه","لعبة"],
    "غلايه": ["غلاية","ابريق"],
    "صابونيه": ["صابونيه","صابون","صابونه"],
    "ابل": ["ايفون","ابل","ايفون"],

    /* ----------- مشتقات وتصريفات ----------- */
    "حذاءات": ["حذاء","حذا","جزمة"],
    "قمصان": ["قميص","قميصات"],
    "بنطالات": ["بنطلون","بنطال"],
    "فساتين": ["فستان","فستانات"],
    "شواحن": ["شاحن","شاحنات"],
    "سماعات": ["سماعة","هيدفون"],
    "نظارات": ["نظارة","نضاره"],
    "اكواب": ["كوب","كاسات"],

    /* ----------- أخطاء إملائية شائعة ----------- */
    "احذيه": ["احذية","حذاء"],
    "حذيه": ["حذاء","احذية"],
    "صابونه": ["صابونة","صابون"],
    "نضاره": ["نظارة","نضاره"],
    "شنات": ["شنطة","شنط"],
    "بنطال": ["بنطلون","سروال"],
    "برفانات": ["برفان","عطر"],
    "ايفون": ["سماعة","هيدفون"],
    "هاتف": ["موبايل","جوال"],

    /* ----------- عامي تداولي ----------- */
    "جوال": ["موبايل","تلفون"],
    "موبايل": ["جوال","تلفون"],
    "تلفون": ["جوال","موبايل"],
    "تابلت": ["تابلت","ايباد"],
    "ايباد": ["تابلت","اي باد"],

    /* ----------- أقمشة ----------- */
    "قطن": ["قماش","قطني"],
    "قماش": ["ملابس","قطن"],
    "صوف": ["قماش","لباس"],

    /* ----------- أدوات مكتبية ----------- */
    "دفتر": ["دفتر","دفاتر"],
    "دفاتر": ["دفتر","مفكرة"],
    "قلم": ["اقلام","قلم"],
    "اقلام": ["قلم","دفتر"],

    /* ----------- فئات عامة مرتبطة بالتجارة ----------- */
    "رجالي": ["رجال","رجالـي","ملابس رجالي"],
    "نساء": ["نسائي","نساء","ملابس نسائي"],
    "اولادي": ["اطفال","اولاد","بنات"],
    "عائلي": ["عائلي","عائليه"],

    /* ----------- كلمات عامة اخرى ----------- */
    "عرض": ["خصم","تخفيض","فرصة"],
    "خصم": ["عرض","تخفيض"],
    "تخفيض": ["خصم","عرض"],
    "جديد": ["حديث","حديثه"],
    "مستعمل": ["مستعمله","مستخدم"],
    "مستخدم": ["مستعمل","مستخدمة"],
    
    /* ----------- اضافة المزيد والمرادفات ----------- */
    "كتاب": ["كتب","اقتبس"],
    "كتب": ["كتاب","مجلة"],
    "مجلة": ["كتب","كتاب"],

    "ساعه": ["ساعات","ساعة"],
    "ساعات": ["ساعة","ساعه"],

    "نظافه": ["تنظيف","منظف"],
    "تنظيف": ["نظافه","منظف"],
    "منظف": ["نظيف","تنظيف"],

    "سعر": ["تكلفة","ثمن"]
};

/* ===== 3. FAST keyword extraction ===== */
function getSmartKeywords(input) {
    const base = normalizeArabic(input);
    const words = base.split(" ");

    const set = new Set();

    words.forEach(w => {
        if (!w) return;

        set.add(w);

        // add synonyms
        if (RAW_DICTIONARY[w]) {
            RAW_DICTIONARY[w].forEach(s => {
                set.add(normalizeArabic(s));
            });
        }

        // misspell slicing: remove first/last letter
        if (w.length > 3) {
            set.add(w.slice(1));
            set.add(w.slice(0, -1));
        }

        // singular/plural light handling
        if (w.endsWith("ات")) set.add(w.replace("ات","ه"));
        if (w.endsWith("ه")) set.add(w.replace("ه","ات"));
    });

    return [...set];
}
